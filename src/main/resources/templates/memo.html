<!DOCTYPE html>
<html>
<head>
    <title>Memo App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .memo-form {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
            margin-bottom: 20px;
        }

        .memo-list {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }

        label {
            font-weight: bold;
        }

        textarea, input {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            background-color: white;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Memo App</h1>

    <div class="memo-form">
        <h2>Create Memo</h2>
        <form id="createMemoForm">
            <label for="username">Username:</label>
            <input type="text" id="username" name="title" required><br> <!-- name 속성 수정 -->

            <label for="title">Title:</label>
            <input type="text" id="title" name="username" required><br> <!-- name 속성 수정 -->

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required><br>

            <label for="contents">Contents:</label>
            <textarea id="contents" name="contents" rows="4" required></textarea><br>

            <button type="button" onclick="createMemo()">Create Memo</button>
        </form>

    </div>

    <div class="memo-list">
        <h2>Memo List</h2>
        <input type="text" id="searchUsername" placeholder="Search by username">
        <button onclick="searchMemos()">Search</button>
        <ul id="memoList"></ul>
    </div>
</div>

<script>
    function getMemos() {
        fetch('/api/get')
            .then(response => response.json())
            .then(data => displayMemos(data))
            .catch(error => console.error('Error:', error));
    }

    function displayMemos(memos) {
        var memoList = document.getElementById("memoList");
        memoList.innerHTML = "";

        memos.forEach(function(memo) {
            var listItem = document.createElement("li");
            listItem.innerHTML = "Title: " + memo.title + "<br>Username: " + memo.username + "<br>Contents: " + memo.contents;

            var editButton = document.createElement("button");
            editButton.innerText = "Edit";
            editButton.onclick = function() {
                var editedTitle = prompt("Edit the title:", memo.title);
                var editedContents = prompt("Edit the contents:", memo.contents);

                if (editedTitle !== null && editedContents !== null) {
                    var data = {
                        title: editedTitle,
                        username: memo.username,
                        contents: editedContents,
                        date: null
                    };

                    fetch('/api/put/' + memo.username, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                        .then(response => response.json())
                        .then(data => {
                            alert("Memo updated: " + data.title);
                            getMemos();
                        })
                        .catch(error => console.error('Error:', error));
                }
            };

            var deleteButton = document.createElement("button");
            deleteButton.innerText = "Delete";
            deleteButton.onclick = function() {
                if (confirm("Are you sure you want to delete this memo?")) {
                    var password = prompt("Enter your password to delete:", memo.password);

                    if (password !== null) {
                        fetch('/api/delete/' + memo.username, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(password)
                        })
                            .then(response => {
                                if (response.ok) {
                                    alert("Memo deleted.");
                                    getMemos();
                                } else {
                                    alert("Error deleting the memo.");
                                }
                            })
                            .catch(error => console.error('Error:', error));
                    }
                }
            };

            listItem.appendChild(editButton);
            listItem.appendChild(deleteButton);
            memoList.appendChild(listItem);
        });
    }


    // Initially load memos when the page loads
    getMemos();
    function createMemo() {
        var title = document.getElementById("title").value; // "title" 필드에서 제목을 가져오도록 수정
        var username = document.getElementById("username").value; // "username" 필드에서 사용자 이름을 가져오도록 수정
        var password = document.getElementById("password").value;
        var contents = document.getElementById("contents").value;

        var data = {
            username: username,
            title: title, // "title"과 "username" 위치를 바꿔서 제목과 사용자 이름이 올바르게 전송되도록 수정
            password: password,
            contents: contents,
            date: null
        };

        fetch('/api/post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(data => {
                alert(data.username + " created a memo: " + data.title);
                getMemos();
            })
            .catch(error => console.error('Error:', error));
    }

</script>
</body>
</html>
