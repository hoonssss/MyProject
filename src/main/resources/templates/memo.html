<!DOCTYPE html>
<html>
<head>
    <title>Memo App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .memo-form {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
            margin-bottom: 20px;
        }

        .memo-list {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }

        label {
            font-weight: bold;
        }

        textarea, input {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            background-color: white;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Memo App</h1>

    <div class="memo-form">
        <h2>Create Memo</h2>
        <form id="createMemoForm">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required><br>

            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required><br>

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required><br>

            <label for="contents">Contents:</label>
            <textarea id="contents" name="contents" rows="4" required></textarea><br>

            <button type="button" onclick="createMemo()">Create Memo</button>
        </form>

    </div>

    <div class="memo-list">
        <h2>Memo List</h2>
        <input type="text" id="searchUsername" placeholder="Search by username">
        <button onclick="searchMemos()">Search</button>
        <ul id="memoList"></ul>
    </div>
</div>

<script>
    function getMemos() {
        fetch('/api/get')
            .then(response => response.json())
            .then(data => displayMemos(data))
            .catch(error => console.error('Error:', error));
    }
    function deleteMemo(username) {
        var password = prompt("Enter your password to delete:");
        if (password !== null) {
            fetch('/api/delete/' + username, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ password: password }),
            })
                .then(response => {
                    if (response.ok) {
                        alert("Memo deleted.");
                        getMemos();
                    } else {
                        alert("Error deleting the memo.");
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    }

    function displayMemos(memos) {
        var memoList = document.getElementById("memoList");
        memoList.innerHTML = "";

        memos.forEach(function(memo) {
            var listItem = document.createElement("li");
            listItem.innerHTML = "Title: " + memo.title + "<br>Username: " + memo.username + "<br>Contents: " + memo.contents;

            var editButton = document.createElement("button");
            editButton.innerText = "Edit";
            editButton.onclick = function() {
                var password = prompt("Enter your password to edit this memo:", ""); // 비밀번호 입력 추가
                if (password !== null) {
                    var editedTitle = prompt("Edit the title:", memo.title);
                    var editedContents = prompt("Edit the contents:", memo.contents);

                    if (editedTitle !== null && editedContents !== null) {
                        var data = {
                            title: editedTitle,
                            username: memo.username,
                            contents: editedContents,
                            password: password, // 수정 작업을 수행할 때 비밀번호도 전송
                            date: null
                        };

                        fetch('/api/put/' + memo.username, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        })
                            .then(response => response.json())
                            .then(data => {
                                alert("Memo updated: " + data.title);
                                getMemos();
                            })
                            .catch(error => console.error('Error:', error));
                    }
                }
            };

            var deleteButton = document.createElement("button");
            deleteButton.innerText = "Delete";
            deleteButton.onclick = function() {
                if (confirm("Are you sure you want to delete this memo?")) {
                    var password = prompt("Enter your password to delete:", "");

                    if (password !== null) {
                        fetch('/api/delete/' + memo.username + '?password=' + password, {
                            method: 'DELETE'
                        })
                            .then(response => {
                                if (response.ok) {
                                    alert("Memo deleted.");
                                    getMemos();
                                } else {
                                    alert("Error deleting the memo.");
                                }
                            })
                            .catch(error => console.error('Error:', error));
                    }
                }
            };

            listItem.appendChild(editButton);
            listItem.appendChild(deleteButton);
            memoList.appendChild(listItem);
        });
    }

    // Initially load memos when the page loads
    getMemos();

    function createMemo() {
        var title = document.getElementById("title").value;
        var username = document.getElementById("username").value;
        var password = document.getElementById("password").value;
        var contents = document.getElementById("contents").value;

        var data = {
            username: username,
            title: title,
            password: password,
            contents: contents,
            date: null
        };

        fetch('/api/post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(data => {
                alert(data.username + " created a memo: " + data.title);
                getMemos();
            })
            .catch(error => console.error('Error:', error));
    }
</script>
</body>
</html>
